# Tasks in this file are meant to be usable not only
# in the workspace root but in the member crates as well
#
# ie. you shouldn't have to switch from a member crate to the
# workspace root in order to run fmt or clippy
#
# This file is meant to be used as an extension to both Makefile in the
# workspace root as well as in the member crates.

[tasks.clippy]
args          = ["clippy", "--all-targets", "--", "-D", "warnings"]
command       = "cargo"
install_crate = "clippy"
toolchain     = "nightly"

[tasks.format]
args          = ["fmt"]
command       = "cargo"
install_crate = "rustfmt"
toolchain     = "nightly"

[tasks.format-check]
args          = ["fmt", "--", "--check"]
command       = "cargo"
install_crate = "rustfmt"
toolchain     = "nightly"

[tasks.clippy-fix]
args          = ['clippy', "--all-targets", "--fix", "--allow-no-vcs", "--", "-D", "warnings"]
command       = "cargo"
env           = { "__CARGO_FIX_YOLO" = "1" }
install_crate = "clippy"
toolchain     = "nightly"

[tasks.code-fix]
run_task = { name = ["clippy-fix", "format"] }

# +----------------+
# | DOCKER HELPERS |
# +----------------+

[tasks.docker]
env       = { "SUBCOMMAND_PREFIX" = "docker" }
extend    = "subcommand"
private   = false
workspace = false

[tasks.subcommand]
private = true
script = '''
#!@duckscript

cm_run_task ${SUBCOMMAND_PREFIX}_${1}
'''

[tasks.docker_redis-start]
args    = ["run", "-d", "--rm", "--publish=6379:6379", "--name=cargoredis", "redis"]
command = "docker"
private = true

[tasks.docker_redis-stop]
args    = ["stop", "cargoredis"]
command = "docker"
private = true
